# TABLICE/ParametryPretowZbrojeniowych.py

from __future__ import annotations
from dataclasses import dataclass
import math

# ============================================================
#  PODSTAWOWE PARAMETRY PRĘTÓW (ŚREDNICA, As [mm2], MASA [kg/m])
# ============================================================

@dataclass(frozen=True)
class ParametryPreta:
    """
    Zawiera podstawowe parametry pojedynczego pręta zbrojeniowego.
    - fi (φ) jest średnicą nominalną [mm]
    - As to pole przekroju [mm²]
    - masa_liniowa to ciężar na jednostkę długości [kg/m]
    """
    fi: int             # Średnica nominalna [mm]
    As: float           # Pole przekroju [mm²]
    masa_liniowa: float # Ciężar liniowy [kg/m]


# Gęstość stali (przyjęta 7850 kg/m³)
GESTOSC_STALI = 7850.0  # [kg/m³]


def oblicz_parametry(fi_mm: int) -> ParametryPreta:
    """
    Oblicza pole przekroju i masę liniową dla danej średnicy fi [mm].
    """
    # Przeliczenie fi na metry
    fi_m = fi_mm / 1000.0

    # 1. Pole przekroju As [mm²]
    As_mm2 = math.pi * (fi_mm / 2.0) ** 2

    # 2. Masa liniowa [kg/m]
    # Masa = Gęstość * Objętość (dla 1m długości: V = A * 1m)
    As_m2 = math.pi * (fi_m / 2.0) ** 2
    masa_liniowa = GESTOSC_STALI * As_m2

    return ParametryPreta(
        fi=fi_mm,
        As=As_mm2,
        masa_liniowa=masa_liniowa,
    )


# Słownik z parametrami prętów – podstawowy zakres średnic
PARAMETRY_PRETOW: dict[int, ParametryPreta] = {
    fi: oblicz_parametry(fi)
    for fi in [6, 8, 10, 12, 14, 16, 18, 20, 22, 25, 28, 32, 40]
}


def get_bar_params(fi_mm: int) -> ParametryPreta:
    """
    Zwraca obiekt ParametryPreta dla wybranej średnicy.
    """
    if fi_mm in PARAMETRY_PRETOW:
        return PARAMETRY_PRETOW[fi_mm]
    raise ValueError(f"Nieznana średnica pręta: {fi_mm} mm.")


def list_bar_diameters() -> list[int]:
    """
    Zwraca listę dostępnych średnic prętów.
    """
    return sorted(list(PARAMETRY_PRETOW.keys()))

# ============================================================
#  TABELA NR 2 — BELE / SŁUPY (As [cm²] dla n sztuk prętów)
# ============================================================

TABLICA_BELE_SŁUPY: dict[int, dict[int, float]] = {
    8:  {2:1.01,3:1.51,4:2.01,5:2.51,6:3.02,7:3.52,8:4.02,9:4.52,10:5.03,11:5.53,12:6.03},
    10: {2:1.57,3:2.36,4:3.14,5:3.93,6:4.71,7:5.50,8:6.28,9:7.07,10:7.85,11:8.64,12:9.42},
    12: {2:2.26,3:3.39,4:4.52,5:5.65,6:6.79,7:7.92,8:9.05,9:10.18,10:11.31,11:12.44,12:13.57},
    14: {2:3.08,3:4.62,4:6.16,5:7.70,6:9.24,7:10.78,8:12.32,9:13.85,10:15.39,11:16.93,12:18.47},
    16: {2:4.02,3:6.03,4:8.04,5:10.05,6:12.07,7:14.07,8:16.08,9:18.10,10:20.11,11:22.12,12:24.13},
    18: {2:5.09,3:7.63,4:10.18,5:12.72,6:15.27,7:17.81,8:20.36,9:22.90,10:25.45,11:27.99,12:30.54},
    20: {2:6.28,3:9.42,4:12.57,5:15.71,6:18.85,7:21.99,8:25.13,9:28.27,10:31.42,11:34.56,12:37.70},
    22: {2:7.60,3:11.40,4:15.21,5:19.01,6:22.81,7:26.61,8:30.41,9:34.21,10:38.01,11:41.81,12:45.62},
    25: {2:9.82,3:14.73,4:19.63,5:24.54,6:29.45,7:34.36,8:39.27,9:44.18,10:49.09,11:54.00,12:58.90},
    28: {2:12.32,3:18.47,4:24.63,5:30.79,6:36.95,7:43.10,8:49.26,9:55.42,10:61.58,11:67.73,12:73.89},
    30: {2:14.14,3:21.21,4:28.27,5:35.34,6:42.41,7:49.48,8:56.55,9:63.62,10:70.69,11:77.75,12:84.82},
    32: {2:16.08,3:24.13,4:32.17,5:40.21,6:48.25,7:56.30,8:64.34,9:72.38,10:80.42,11:88.47,12:96.51},
    36: {2:20.36,3:30.54,4:40.72,5:50.89,6:61.07,7:71.25,8:81.43,9:91.61,10:101.79,11:111.97,12:122.15},
    40: {2:25.13,3:37.70,4:50.27,5:62.83,6:75.40,7:87.96,8:100.53,9:113.10,10:125.66,11:138.23,12:150.80},
}


def get_As_belek_slupek(fi: int, liczba: int) -> float:
    """
    Zwraca As [cm²] dla zadanej średnicy fi i liczby prętów.

    Jeśli dokładna kombinacja nie występuje w tabeli
    (np. 1 szt.), szacuje na podstawie As jednego pręta
    (As_2 / 2) * liczba.
    """
    wiersz = TABLICA_BELE_SŁUPY.get(fi)
    if wiersz is None:
        return 0.0

    if liczba in wiersz:
        return wiersz[liczba]

    # Szacowanie dla liczby spoza tabeli
    As1 = wiersz[2] / 2.0
    return round(As1 * liczba, 2)

# ============================================================
#  TABELA NR 1 — PŁYTY / ŚCIANY (As [cm²/m])
# ============================================================

TABLICA_PLYTY: dict[float, dict[float, float]] = {
    4.5:{5:3.18,8:1.99,10:1.59,11:1.45,12:1.33,12.5:1.27,13:1.22,14:1.14,15:1.06,16:0.99,17:0.94,18:0.88,19:0.84,20:0.80,22:0.72,25:0.64,30:0.53},
    6:{5:5.65,8:3.53,10:2.83,11:2.57,12:2.36,12.5:2.26,13:2.17,14:2.02,15:1.88,16:1.77,17:1.66,18:1.57,19:1.49,20:1.41,22:1.29,25:1.13,30:0.94},
    8:{5:10.05,8:6.28,10:5.03,11:4.57,12:4.19,12.5:4.02,13:3.87,14:3.59,15:3.35,16:3.14,17:2.96,18:2.79,19:2.65,20:2.51,22:2.28,25:2.01,30:1.68},
    10:{5:15.71,8:9.82,10:7.85,11:7.14,12:6.54,12.5:6.28,13:6.04,14:5.61,15:5.24,16:4.91,17:4.62,18:4.36,19:4.13,20:3.93,22:3.57,25:3.14,30:2.62},
    12:{5:22.62,8:14.41,10:11.28,11:10.24,12:9.42,12.5:9.04,13:8.68,14:8.30,15:7.94,16:7.57,17:7.24,18:6.93,19:6.65,20:6.38,22:5.95,25:5.32,30:4.45},
    14:{5:30.79,8:19.24,10:15.39,11:13.99,12:12.83,12.5:12.32,13:11.84,14:11.00,15:10.26,16:9.54,17:9.08,18:8.65,19:8.27,20:7.85,22:7.00,25:6.16,30:5.13},
    16:{5:40.21,8:25.13,10:20.11,11:18.28,12:16.76,12.5:16.08,13:15.47,14:14.36,15:13.40,16:12.51,17:11.79,18:11.12,19:10.58,20:10.05,22:9.14,25:8.04,30:6.72},
    18:{5:50.89,8:31.81,10:25.45,11:23.31,12:21.20,12.5:20.32,13:19.47,14:18.18,15:17.26,16:16.27,17:15.38,18:14.47,19:13.71,20:12.96,22:11.50,25:10.42,30:8.81},
    20:{5:62.83,8:39.27,10:31.42,11:28.56,12:26.19,12.5:25.13,13:24.01,14:22.44,15:20.94,16:19.63,17:18.47,18:17.35,19:16.33,20:15.32,22:13.89,25:11.57,30:9.68},
    22:{5:76.03,8:47.52,10:38.01,11:34.56,12:31.68,12.5:30.41,13:29.24,14:27.15,15:25.39,16:23.72,17:22.36,18:21.07,19:19.85,20:18.74,22:17.28,25:15.21,30:12.67},
    25:{5:98.17,8:61.36,10:49.09,11:44.62,12:40.91,12.5:39.47,13:38.08,14:36.47,15:34.73,16:32.72,17:30.68,18:28.67,19:26.88,20:25.31,22:23.12,25:21.10,30:17.18},
    28:{5:123.15,8:76.97,10:61.58,11:55.98,12:51.31,12.5:49.26,13:47.37,14:45.73,15:43.93,16:42.09,17:40.23,18:38.46,19:36.82,20:35.24,22:33.20,25:29.79,30:25.03},
    30:{5:141.37,8:88.36,10:70.69,11:64.26,12:58.90,12.5:56.55,13:54.37,14:52.09,15:49.41,16:47.12,17:44.18,18:41.58,19:39.27,20:37.20,22:35.04,25:32.18,30:26.81},
    32:{5:160.85,8:100.53,10:80.42,11:73.11,12:67.02,12.5:64.34,13:61.87,14:59.54,15:57.45,16:53.62,17:50.27,18:47.31,19:44.68,20:42.33,22:40.21,25:37.02,30:31.90},
}


def get_As_plyta(fi: float, rozstaw: float) -> float:
    """
    Zwraca As [cm²/m] dla zadanej średnicy pręta (fi) i rozstawu [cm].
    """
    wiersz = TABLICA_PLYTY.get(fi)
    if wiersz is None:
        return 0.0
    return wiersz.get(rozstaw, 0.0)


if __name__ == '__main__':
    print("--- Parametry prętów zbrojeniowych (EC2) ---")
    for fi, params in PARAMETRY_PRETOW.items():
        print(f"φ{params.fi:02d} | As: {params.As:.2f} mm² | Masa: {params.masa_liniowa:.2f} kg/m")

    # Przykład użycia funkcji
    try:
        p18 = get_bar_params(18)
        print(f"\nParametry dla fi 18: As={p18.As:.2f} mm², Masa={p18.masa_liniowa:.2f} kg/m")
    except ValueError as e:
        print(e)
